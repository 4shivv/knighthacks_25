<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KnightMobile - Autonomous Robot Control</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
      overflow: hidden;
    }

    #root {
      width: 100vw;
      height: 100vh;
      display: flex;
      overflow: hidden;
    }

    .scrollbar::-webkit-scrollbar {
      width: 10px;
    }
    .scrollbar::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.03);
      border-radius: 5px;
      margin: 4px;
    }
    .scrollbar::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, #00ff88 0%, #00cc6a 100%);
      border-radius: 5px;
      transition: all 0.3s ease;
    }
    .scrollbar::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(180deg, #00ff88 0%, #00ff88 100%);
    }

    .glass {
      background: rgba(17, 17, 17, 0.7);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(0, 255, 136, 0.2);
      box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
    }

    .glow {
      box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
    }

    .smooth-transition {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .pulse {
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .slide-in {
      animation: slideIn 0.3s ease-out;
    }

    .gradient-text {
      background: linear-gradient(135deg, #00ff88 0%, #00d4ff 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .button-hover:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(0, 255, 136, 0.3);
    }

    @keyframes livePulse {
      0%, 100% {
        box-shadow: 0 0 0 0 rgba(0, 255, 136, 0.7);
      }
      50% {
        box-shadow: 0 0 0 8px rgba(0, 255, 136, 0);
      }
    }

    .live-pulse {
      animation: livePulse 2s infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .spin {
      animation: spin 2s linear infinite;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // Icons
    const SmartphoneIcon = () => (
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <rect x="5" y="2" width="14" height="20" rx="2" ry="2"></rect>
        <line x1="12" y1="18" x2="12.01" y2="18"></line>
      </svg>
    );

    const ScanIcon = () => (
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M3 7V5a2 2 0 0 1 2-2h2"></path>
        <path d="M17 3h2a2 2 0 0 1 2 2v2"></path>
        <path d="M21 17v2a2 2 0 0 1-2 2h-2"></path>
        <path d="M7 21H5a2 2 0 0 1-2-2v-2"></path>
        <circle cx="12" cy="12" r="1"></circle>
      </svg>
    );

    const ActivityIcon = () => (
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
      </svg>
    );

    const SettingsIcon = () => (
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <circle cx="12" cy="12" r="3"></circle>
        <path d="M12 1v6m0 6v6m5.196-14.196L13.5 8.5m-3 3l-3.696 3.696M1 12h6m6 0h6m-14.196 5.196L8.5 13.5m3-3l3.696-3.696"></path>
      </svg>
    );

    const Trash2Icon = () => (
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polyline points="3 6 5 6 21 6"></polyline>
        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
        <line x1="10" y1="11" x2="10" y2="17"></line>
        <line x1="14" y1="11" x2="14" y2="17"></line>
      </svg>
    );

    const TargetIcon = ({ size = 16 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <circle cx="12" cy="12" r="10"></circle>
        <circle cx="12" cy="12" r="6"></circle>
        <circle cx="12" cy="12" r="2"></circle>
      </svg>
    );

    const WifiIcon = () => (
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M5 12.55a11 11 0 0 1 14.08 0"></path>
        <path d="M1.42 9a16 16 0 0 1 21.16 0"></path>
        <path d="M8.53 16.11a6 6 0 0 1 6.95 0"></path>
        <line x1="12" y1="20" x2="12.01" y2="20"></line>
      </svg>
    );

    const VideoIcon = () => (
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polygon points="23 7 16 12 23 17 23 7"></polygon>
        <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
      </svg>
    );

    const XIcon = () => (
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    );

    const PlayIcon = () => (
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polygon points="5 3 19 12 5 21 5 3"></polygon>
      </svg>
    );

    const StopIcon = () => (
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <rect x="6" y="6" width="12" height="12"></rect>
      </svg>
    );

    const RobotIcon = () => (
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <rect x="3" y="11" width="18" height="10" rx="2"></rect>
        <circle cx="12" cy="5" r="2"></circle>
        <path d="M12 7v4"></path>
        <line x1="8" y1="16" x2="8" y2="16"></line>
        <line x1="16" y1="16" x2="16" y2="16"></line>
      </svg>
    );

    const LoaderIcon = () => (
      <svg className="spin" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M21 12a9 9 0 1 1-6.219-8.56"></path>
      </svg>
    );

    // Color scheme
    const colors = {
      bg: '#0a0a0a',
      bgGradient: 'linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%)',
      card: 'rgba(17, 17, 17, 0.7)',
      border: '#00ff88',
      borderDim: 'rgba(0, 255, 136, 0.2)',
      text: '#ffffff',
      textDim: '#888888',
      accent: '#00ff88',
      accentGlow: 'rgba(0, 255, 136, 0.3)',
      danger: '#ff3366',
      warning: '#ffb800',
      info: '#00d4ff',
    };

    const actionColors = {
      'MOVE': colors.accent,
      'FORWARD': colors.accent,
      'TURN': colors.warning,
      'LEFT': colors.warning,
      'RIGHT': colors.warning,
      'STOP': colors.danger,
      'OBSTACLE': colors.danger,
      'SCANNING': colors.info,
      'TARGET': colors.accent,
      'REVERSE': colors.warning,
      'LIDAR': colors.info,
      'ANALYZING': colors.info,
      'NAVIGATING': colors.accent,
    };

    const getActionColor = (actionText) => {
      const upperAction = actionText.toUpperCase();
      for (const [key, color] of Object.entries(actionColors)) {
        if (upperAction.includes(key)) return color;
      }
      return colors.accent;
    };

    function KnightMobile() {
      const [mission, setMission] = useState('Find the red mug');
      const [actions, setActions] = useState([]);
      const [isConnected, setIsConnected] = useState(false);
      const [showSettings, setShowSettings] = useState(false);
      
      const [backendUrl, setBackendUrl] = useState('http://localhost:5000');
      const [streamError, setStreamError] = useState(false);
      const [streamActive, setStreamActive] = useState(false);
      
      const [targetDetected, setTargetDetected] = useState(false);
      const [targetLabel, setTargetLabel] = useState('');
      const [targetConfidence, setTargetConfidence] = useState(0);
      const [obstacleDetected, setObstacleDetected] = useState(false);
      const [currentDirection, setCurrentDirection] = useState('IDLE');
      
      const [lidarActive, setLidarActive] = useState(false);
      const [depthDataAvailable, setDepthDataAvailable] = useState(false);
      const [pointCloudQuality, setPointCloudQuality] = useState('High');
      const [lastScanId, setLastScanId] = useState(null);
      const [scanCount, setScanCount] = useState(0);
      
      // Mission control states
      const [missionActive, setMissionActive] = useState(false);
      const [missionStatus, setMissionStatus] = useState('IDLE');
      const [missionProgress, setMissionProgress] = useState(0);
      
      const logRef = useRef(null);
      const pollInterval = useRef(null);
      const imgRef = useRef(null);

      const testConnection = async () => {
        try {
          const response = await fetch(`${backendUrl}/api/scans`);
          if (response.ok) {
            setIsConnected(true);
            addAction('Backend connected successfully', colors.accent);
            return true;
          }
        } catch (error) {
          console.error('Connection failed:', error);
        }
        setIsConnected(false);
        addAction('Backend connection failed', colors.danger);
        return false;
      };

      const addAction = (text, color = null) => {
        const newAction = {
          text: text,
          time: new Date().toLocaleTimeString('en-US', { hour12: false }),
          color: color || getActionColor(text)
        };
        setActions(prev => [newAction, ...prev.slice(0, 19)]);
      };

      const startMission = async () => {
        if (!mission.trim()) {
          addAction('Error: Mission objective is required', colors.danger);
          return;
        }

        try {
          const response = await fetch(`${backendUrl}/api/start_mission`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              mission: mission,
              timestamp: new Date().toISOString()
            })
          });

          if (response.ok) {
            const data = await response.json();
            setMissionActive(true);
            setMissionStatus('ACTIVE');
            setMissionProgress(0);
            addAction(`Mission started: ${mission}`, colors.accent);
            addAction('Robot is now autonomous', colors.info);
          } else {
            addAction('Failed to start mission', colors.danger);
          }
        } catch (error) {
          console.error('Failed to start mission:', error);
          addAction('Error starting mission', colors.danger);
        }
      };

      const stopMission = async () => {
        try {
          const response = await fetch(`${backendUrl}/api/stop_mission`, {
            method: 'POST'
          });

          if (response.ok) {
            setMissionActive(false);
            setMissionStatus('STOPPED');
            addAction('Mission stopped by user', colors.warning);
          } else {
            addAction('Failed to stop mission', colors.danger);
          }
        } catch (error) {
          console.error('Failed to stop mission:', error);
          addAction('Error stopping mission', colors.danger);
        }
      };

      const fetchScans = async () => {
        try {
          const response = await fetch(`${backendUrl}/api/scans`);
          if (response.ok) {
            const data = await response.json();
            if (data.scans && data.scans.length > 0) {
              const latestScan = data.scans[0];
              if (lastScanId !== latestScan.id) {
                setLastScanId(latestScan.id);
                setScanCount(data.scans.length);
                setLidarActive(true);
                setDepthDataAvailable(true);
                addAction(`LiDAR scan #${latestScan.id} received`, colors.info);
                
                setTimeout(() => setLidarActive(false), 2000);
              }
            }
          }
        } catch (error) {
          console.error('Failed to fetch scans:', error);
        }
      };

      const fetchMissionStatus = async () => {
        if (!missionActive) return;
        
        try {
          const response = await fetch(`${backendUrl}/api/mission_status`);
          if (response.ok) {
            const data = await response.json();
            if (data.status) setMissionStatus(data.status);
            if (data.progress !== undefined) setMissionProgress(data.progress);
            if (data.current_action) {
              addAction(data.current_action, getActionColor(data.current_action));
            }
            if (data.completed) {
              setMissionActive(false);
              setMissionStatus('COMPLETED');
              addAction('Mission completed successfully!', colors.accent);
            }
          }
        } catch (error) {
          console.error('Failed to fetch mission status:', error);
        }
      };

      const clearLog = () => {
        setActions([]);
      };

      useEffect(() => {
        testConnection();
        
        pollInterval.current = setInterval(() => {
          if (isConnected) {
            fetchScans();
            fetchMissionStatus();
          }
        }, 500);
        
        return () => {
          if (pollInterval.current) clearInterval(pollInterval.current);
        };
      }, [backendUrl, isConnected, lastScanId, missionActive]);

      useEffect(() => {
        if (logRef.current) {
          logRef.current.scrollTop = 0;
        }
      }, [actions]);

      const handleImageError = () => {
        setStreamError(true);
        setStreamActive(false);
      };

      const handleImageLoad = () => {
        if (streamError || !streamActive) {
          setStreamError(false);
          setStreamActive(true);
          addAction('Video stream connected', colors.accent);
        }
      };

      const SettingsModal = () => (
        <div style={{
          position: 'fixed',
          top: 0,
          left: 0,
          right: 0,
          bottom: 0,
          backgroundColor: 'rgba(0, 0, 0, 0.85)',
          backdropFilter: 'blur(8px)',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          zIndex: 1000,
          animation: 'slideIn 0.3s ease-out'
        }}>
          <div className="glass" style={{
            borderRadius: '16px',
            padding: '36px',
            maxWidth: '540px',
            width: '90%',
            boxShadow: '0 20px 60px rgba(0, 0, 0, 0.5)'
          }}>
            <div style={{
              display: 'flex',
              justifyContent: 'space-between',
              alignItems: 'center',
              marginBottom: '28px'
            }}>
              <h2 className="gradient-text" style={{ 
                fontSize: '24px',
                fontWeight: '700',
                letterSpacing: '-0.5px'
              }}>
                System Configuration
              </h2>
              <button
                onClick={() => setShowSettings(false)}
                className="smooth-transition"
                style={{
                  backgroundColor: 'transparent',
                  border: 'none',
                  color: colors.textDim,
                  cursor: 'pointer',
                  padding: '8px',
                  borderRadius: '8px',
                  display: 'flex',
                  alignItems: 'center'
                }}
                onMouseEnter={(e) => {
                  e.currentTarget.style.backgroundColor = 'rgba(255, 255, 255, 0.05)';
                  e.currentTarget.style.color = colors.text;
                }}
                onMouseLeave={(e) => {
                  e.currentTarget.style.backgroundColor = 'transparent';
                  e.currentTarget.style.color = colors.textDim;
                }}
              >
                <XIcon />
              </button>
            </div>
            
            <div style={{ display: 'flex', flexDirection: 'column', gap: '24px' }}>
              <div>
                <label style={{ 
                  display: 'block',
                  fontSize: '13px',
                  fontWeight: '600',
                  color: colors.text,
                  marginBottom: '10px',
                  letterSpacing: '0.3px'
                }}>
                  Flask Backend URL
                </label>
                <input
                  type="text"
                  value={backendUrl}
                  onChange={(e) => setBackendUrl(e.target.value)}
                  placeholder="http://localhost:5000"
                  className="smooth-transition"
                  style={{
                    width: '100%',
                    padding: '14px 16px',
                    backgroundColor: 'rgba(0, 0, 0, 0.4)',
                    border: `2px solid ${colors.borderDim}`,
                    borderRadius: '10px',
                    color: colors.text,
                    fontSize: '14px',
                    fontFamily: 'monospace',
                    outline: 'none'
                  }}
                  onFocus={(e) => {
                    e.target.style.borderColor = colors.border;
                    e.target.style.boxShadow = `0 0 0 3px ${colors.accentGlow}`;
                  }}
                  onBlur={(e) => {
                    e.target.style.borderColor = colors.borderDim;
                    e.target.style.boxShadow = 'none';
                  }}
                />
              </div>
              
              <div className="glass" style={{
                padding: '16px',
                borderRadius: '10px',
                border: `1px solid rgba(0, 212, 255, 0.2)`,
                backgroundColor: 'rgba(0, 212, 255, 0.05)'
              }}>
                <p style={{ 
                  fontSize: '13px', 
                  color: colors.info, 
                  margin: 0,
                  lineHeight: '1.6',
                  display: 'flex',
                  gap: '10px'
                }}>
                  <span>💡</span>
                  <span>Backend should implement /api/start_mission and /api/stop_mission endpoints</span>
                </p>
              </div>
              
              <div style={{
                display: 'flex',
                gap: '12px',
                marginTop: '8px'
              }}>
                <button
                  onClick={async () => {
                    const connected = await testConnection();
                    if (connected) {
                      setShowSettings(false);
                    }
                  }}
                  className="smooth-transition button-hover"
                  style={{
                    flex: 1,
                    background: `linear-gradient(135deg, ${colors.accent} 0%, #00cc6a 100%)`,
                    color: colors.bg,
                    border: 'none',
                    borderRadius: '10px',
                    padding: '14px',
                    cursor: 'pointer',
                    fontSize: '15px',
                    fontWeight: '700',
                    letterSpacing: '0.3px'
                  }}
                >
                  Test & Save
                </button>
                <button
                  onClick={() => setShowSettings(false)}
                  className="smooth-transition"
                  style={{
                    flex: 1,
                    backgroundColor: 'transparent',
                    color: colors.textDim,
                    border: `2px solid ${colors.borderDim}`,
                    borderRadius: '10px',
                    padding: '14px',
                    cursor: 'pointer',
                    fontSize: '15px',
                    fontWeight: '600'
                  }}
                  onMouseEnter={(e) => {
                    e.target.style.borderColor = colors.border;
                    e.target.style.color = colors.border;
                  }}
                  onMouseLeave={(e) => {
                    e.target.style.borderColor = colors.borderDim;
                    e.target.style.color = colors.textDim;
                  }}
                >
                  Cancel
                </button>
              </div>
            </div>
          </div>
        </div>
      );

      return (
        <div style={{
          display: 'flex',
          width: '100vw',
          height: '100vh',
          background: colors.bgGradient,
          color: colors.text,
          overflow: 'hidden'
        }}>
          {showSettings && <SettingsModal />}
          
          {/* Left Side - Camera Feed */}
          <div style={{
            flex: 1,
            display: 'flex',
            flexDirection: 'column',
            padding: '24px',
            gap: '20px',
            minWidth: 0,
            overflow: 'hidden'
          }}>
            {/* Header */}
            <div style={{
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'space-between',
              flexShrink: 0
            }}>
              <div>
                <div style={{
                  display: 'inline-block',
                  padding: '12px 20px',
                  background: 'rgba(255, 255, 255, 0.08)',
                  backdropFilter: 'blur(10px)',
                  borderRadius: '12px',
                  border: '1px solid rgba(255, 255, 255, 0.15)',
                  boxShadow: '0 4px 16px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1)'
                }}>
                  <h1 style={{
                    fontSize: '32px',
                    fontWeight: '800',
                    margin: 0,
                    display: 'flex',
                    alignItems: 'center',
                    gap: '12px',
                    letterSpacing: '-1px'
                  }}>
                    <span style={{
                      background: 'linear-gradient(135deg, #FFD700 0%, #FFA500 100%)',
                      WebkitBackgroundClip: 'text',
                      WebkitTextFillColor: 'transparent',
                      backgroundClip: 'text',
                      textShadow: '0 0 20px rgba(255, 215, 0, 0.2)'
                    }}>
                      KNIGHT
                    </span>
                    <span style={{ 
                      background: 'linear-gradient(135deg, #ffffff 0%, #e0e0e0 100%)',
                      WebkitBackgroundClip: 'text',
                      WebkitTextFillColor: 'transparent',
                      backgroundClip: 'text',
                      textShadow: '0 0 20px rgba(255, 255, 255, 0.2)'
                    }}>
                      MOBILE
                    </span>
                  </h1>
                </div>
                <p style={{
                  fontSize: '13px',
                  color: colors.textDim,
                  margin: '8px 0 0 4px',
                  letterSpacing: '0.5px'
                }}>
                  Autonomous Robot Navigation System
                </p>
              </div>
              
              <button
                onClick={() => setShowSettings(true)}
                className="glass smooth-transition button-hover"
                style={{
                  border: `1px solid ${colors.borderDim}`,
                  color: colors.accent,
                  borderRadius: '12px',
                  padding: '12px',
                  cursor: 'pointer',
                  display: 'flex',
                  alignItems: 'center',
                  gap: '8px',
                  backgroundColor: colors.card
                }}
              >
                <SettingsIcon />
              </button>
            </div>

            {/* Camera Feed */}
            <div className="glass glow" style={{
              flex: 1,
              borderRadius: '16px',
              overflow: 'hidden',
              position: 'relative',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              minHeight: 0,
              border: `2px solid ${colors.borderDim}`
            }}>
              {isConnected ? (
                <img
                  ref={imgRef}
                  src={`${backendUrl}/api/stream`}
                  alt="Robot Camera Stream"
                  onError={handleImageError}
                  onLoad={handleImageLoad}
                  style={{
                    width: '100%',
                    height: '100%',
                    objectFit: 'contain'
                  }}
                />
              ) : (
                <div style={{
                  textAlign: 'center',
                  padding: '48px'
                }}>
                  <div style={{
                    display: 'flex',
                    justifyContent: 'center',
                    marginBottom: '20px',
                    opacity: 0.5
                  }}>
                    <SmartphoneIcon />
                  </div>
                  <p style={{ color: colors.text, fontSize: '16px', fontWeight: '600', marginBottom: '8px' }}>
                    Connecting to backend...
                  </p>
                  <p style={{ color: colors.textDim, fontSize: '12px', marginBottom: '24px' }}>
                    {backendUrl}
                  </p>
                  <button
                    onClick={() => setShowSettings(true)}
                    className="smooth-transition button-hover"
                    style={{
                      background: `linear-gradient(135deg, ${colors.accent} 0%, #00cc6a 100%)`,
                      color: colors.bg,
                      border: 'none',
                      borderRadius: '10px',
                      padding: '12px 24px',
                      cursor: 'pointer',
                      fontSize: '14px',
                      fontWeight: '600'
                    }}
                  >
                    Configure Backend
                  </button>
                </div>
              )}

              {/* Stream Status */}
              {isConnected && (
                <div className={streamActive ? 'live-pulse' : ''} style={{
                  position: 'absolute',
                  top: '16px',
                  left: '16px',
                  background: streamActive 
                    ? `linear-gradient(135deg, ${colors.accent} 0%, #00cc6a 100%)`
                    : 'rgba(136, 136, 136, 0.9)',
                  color: colors.bg,
                  padding: '10px 16px',
                  borderRadius: '10px',
                  fontSize: '12px',
                  fontWeight: '700',
                  display: 'flex',
                  alignItems: 'center',
                  gap: '8px',
                  letterSpacing: '0.5px',
                  boxShadow: streamActive ? `0 4px 20px ${colors.accentGlow}` : 'none'
                }}>
                  <VideoIcon />
                  {streamActive ? 'LIVE' : 'WAITING'}
                </div>
              )}

              {/* Mission Status Overlay */}
              {missionActive && (
                <div className="slide-in" style={{
                  position: 'absolute',
                  top: '16px',
                  right: '16px',
                  background: `linear-gradient(135deg, ${colors.info} 0%, #0099cc 100%)`,
                  color: colors.bg,
                  padding: '10px 16px',
                  borderRadius: '10px',
                  fontSize: '12px',
                  fontWeight: '700',
                  display: 'flex',
                  alignItems: 'center',
                  gap: '8px',
                  boxShadow: `0 4px 20px rgba(0, 212, 255, 0.3)`
                }}>
                  <LoaderIcon />
                  {missionStatus}
                </div>
              )}

              {/* LiDAR Scanning */}
              {lidarActive && (
                <div className="slide-in" style={{
                  position: 'absolute',
                  top: missionActive ? '70px' : '16px',
                  right: '16px',
                  background: `linear-gradient(135deg, ${colors.info} 0%, #0099cc 100%)`,
                  color: colors.bg,
                  padding: '10px 16px',
                  borderRadius: '10px',
                  fontSize: '12px',
                  fontWeight: '700',
                  display: 'flex',
                  alignItems: 'center',
                  gap: '8px',
                  boxShadow: `0 4px 20px rgba(0, 212, 255, 0.3)`
                }}>
                  <ScanIcon />
                  LiDAR Scanning...
                </div>
              )}

              {/* Obstacle Warning */}
              {obstacleDetected && (
                <div className="slide-in" style={{
                  position: 'absolute',
                  bottom: '16px',
                  left: '50%',
                  transform: 'translateX(-50%)',
                  background: `linear-gradient(135deg, ${colors.danger} 0%, #cc0033 100%)`,
                  color: colors.text,
                  padding: '14px 28px',
                  borderRadius: '12px',
                  fontSize: '16px',
                  fontWeight: '700',
                  boxShadow: `0 6px 24px rgba(255, 51, 102, 0.4)`,
                  letterSpacing: '0.5px'
                }}>
                  ⚠️ OBSTACLE DETECTED
                </div>
              )}

              {/* Timestamp */}
              <div className="glass" style={{
                position: 'absolute',
                bottom: '16px',
                right: '16px',
                padding: '8px 14px',
                borderRadius: '8px',
                fontSize: '12px',
                fontFamily: 'monospace',
                fontWeight: '600',
                border: `1px solid ${colors.borderDim}`
              }}>
                {new Date().toLocaleTimeString('en-US', { hour12: false })}
              </div>
            </div>

            {/* Mission Control */}
            <div className="glass" style={{
              borderRadius: '16px',
              padding: '20px',
              flexShrink: 0,
              border: `2px solid ${missionActive ? colors.accent : colors.borderDim}`,
              background: missionActive ? 'rgba(0, 255, 136, 0.05)' : colors.card
            }}>
              <div style={{
                display: 'flex',
                alignItems: 'center',
                gap: '10px',
                marginBottom: '16px'
              }}>
                <RobotIcon />
                <label style={{
                  fontSize: '12px',
                  color: missionActive ? colors.accent : colors.textDim,
                  fontWeight: '700',
                  letterSpacing: '1px',
                  textTransform: 'uppercase'
                }}>
                  Mission Control {missionActive && '- ACTIVE'}
                </label>
              </div>

              <input
                type="text"
                value={mission}
                onChange={(e) => setMission(e.target.value)}
                placeholder="Enter robot objective (e.g., 'Find the red mug')"
                disabled={missionActive}
                className="smooth-transition"
                style={{
                  width: '100%',
                  padding: '14px 16px',
                  backgroundColor: 'rgba(0, 0, 0, 0.4)',
                  border: `2px solid ${colors.borderDim}`,
                  borderRadius: '10px',
                  color: colors.text,
                  fontSize: '15px',
                  outline: 'none',
                  marginBottom: '16px',
                  opacity: missionActive ? 0.6 : 1
                }}
                onFocus={(e) => {
                  if (!missionActive) {
                    e.target.style.borderColor = colors.border;
                    e.target.style.boxShadow = `0 0 0 3px ${colors.accentGlow}`;
                  }
                }}
                onBlur={(e) => {
                  e.target.style.borderColor = colors.borderDim;
                  e.target.style.boxShadow = 'none';
                }}
              />

              {/* Progress Bar */}
              {missionActive && (
                <div style={{
                  width: '100%',
                  height: '8px',
                  backgroundColor: 'rgba(0, 0, 0, 0.4)',
                  borderRadius: '4px',
                  overflow: 'hidden',
                  marginBottom: '16px'
                }}>
                  <div style={{
                    width: `${missionProgress}%`,
                    height: '100%',
                    background: `linear-gradient(90deg, ${colors.accent} 0%, ${colors.info} 100%)`,
                    transition: 'width 0.5s ease'
                  }} />
                </div>
              )}

              <div style={{
                display: 'flex',
                gap: '12px'
              }}>
                {!missionActive ? (
                  <button
                    onClick={startMission}
                    disabled={!isConnected}
                    className="smooth-transition button-hover"
                    style={{
                      flex: 1,
                      background: isConnected 
                        ? `linear-gradient(135deg, ${colors.accent} 0%, #00cc6a 100%)`
                        : 'rgba(136, 136, 136, 0.3)',
                      color: isConnected ? colors.bg : colors.textDim,
                      border: 'none',
                      borderRadius: '10px',
                      padding: '14px',
                      cursor: isConnected ? 'pointer' : 'not-allowed',
                      fontSize: '15px',
                      fontWeight: '700',
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'center',
                      gap: '10px'
                    }}
                  >
                    <PlayIcon />
                    Start Mission
                  </button>
                ) : (
                  <button
                    onClick={stopMission}
                    className="smooth-transition button-hover"
                    style={{
                      flex: 1,
                      background: `linear-gradient(135deg, ${colors.danger} 0%, #cc0033 100%)`,
                      color: colors.text,
                      border: 'none',
                      borderRadius: '10px',
                      padding: '14px',
                      cursor: 'pointer',
                      fontSize: '15px',
                      fontWeight: '700',
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'center',
                      gap: '10px'
                    }}
                  >
                    <StopIcon />
                    Stop Mission
                  </button>
                )}
              </div>
            </div>
          </div>

          {/* Right Side - Status Dashboard */}
          <div 
            className="scrollbar"
            style={{
              width: '440px',
              flexShrink: 0,
              backgroundColor: 'transparent',
              padding: '24px 24px 24px 0',
              display: 'flex',
              flexDirection: 'column',
              gap: '20px',
              overflowY: 'auto',
              overflowX: 'hidden'
            }}>
            
            {/* System Status */}
            <div className="glass" style={{
              borderRadius: '16px',
              padding: '20px',
              border: `1px solid ${colors.borderDim}`
            }}>
              <div style={{
                display: 'flex',
                alignItems: 'center',
                gap: '10px',
                marginBottom: '18px'
              }}>
                <WifiIcon />
                <h3 style={{ 
                  fontSize: '14px', 
                  fontWeight: '700', 
                  margin: 0, 
                  letterSpacing: '0.5px',
                  textTransform: 'uppercase'
                }}>
                  System Status
                </h3>
              </div>
              
              <div style={{ display: 'flex', flexDirection: 'column', gap: '14px' }}>
                <div style={{ 
                  display: 'flex', 
                  justifyContent: 'space-between', 
                  alignItems: 'center',
                  padding: '10px',
                  backgroundColor: 'rgba(0, 0, 0, 0.2)',
                  borderRadius: '8px'
                }}>
                  <span style={{ fontSize: '13px', color: colors.textDim, fontWeight: '500' }}>Backend</span>
                  <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                    <div className={isConnected ? 'pulse' : ''} style={{
                      width: '8px',
                      height: '8px',
                      borderRadius: '50%',
                      backgroundColor: isConnected ? colors.accent : colors.danger
                    }} />
                    <span style={{
                      fontSize: '13px',
                      fontWeight: '700',
                      color: isConnected ? colors.accent : colors.danger
                    }}>
                      {isConnected ? 'Connected' : 'Disconnected'}
                    </span>
                  </div>
                </div>
                
                <div style={{ 
                  display: 'flex', 
                  justifyContent: 'space-between', 
                  alignItems: 'center',
                  padding: '10px',
                  backgroundColor: 'rgba(0, 0, 0, 0.2)',
                  borderRadius: '8px'
                }}>
                  <span style={{ fontSize: '13px', color: colors.textDim, fontWeight: '500' }}>Video Stream</span>
                  <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                    <div className={streamActive ? 'pulse' : ''} style={{
                      width: '8px',
                      height: '8px',
                      borderRadius: '50%',
                      backgroundColor: streamActive ? colors.accent : colors.textDim
                    }} />
                    <span style={{
                      fontSize: '13px',
                      fontWeight: '700',
                      color: streamActive ? colors.accent : colors.textDim
                    }}>
                      {streamActive ? 'Live' : 'Waiting'}
                    </span>
                  </div>
                </div>
                
                <div style={{ 
                  display: 'flex', 
                  justifyContent: 'space-between', 
                  alignItems: 'center',
                  padding: '10px',
                  backgroundColor: 'rgba(0, 0, 0, 0.2)',
                  borderRadius: '8px'
                }}>
                  <span style={{ fontSize: '13px', color: colors.textDim, fontWeight: '500' }}>Mission</span>
                  <span style={{ 
                    fontSize: '13px', 
                    fontWeight: '700', 
                    color: missionActive ? colors.accent : colors.textDim,
                    padding: '4px 10px',
                    backgroundColor: missionActive ? 'rgba(0, 255, 136, 0.1)' : 'transparent',
                    borderRadius: '6px'
                  }}>
                    {missionActive ? 'ACTIVE' : 'IDLE'}
                  </span>
                </div>
              </div>
            </div>

            {/* LiDAR Status */}
            <div className="glass" style={{
              borderRadius: '16px',
              padding: '20px',
              border: `2px solid rgba(0, 212, 255, 0.3)`,
              background: 'rgba(0, 212, 255, 0.05)'
            }}>
              <div style={{
                display: 'flex',
                alignItems: 'center',
                gap: '10px',
                marginBottom: '18px'
              }}>
                <ScanIcon />
                <h3 style={{ 
                  fontSize: '14px', 
                  fontWeight: '700', 
                  margin: 0, 
                  letterSpacing: '0.5px',
                  textTransform: 'uppercase',
                  color: colors.info
                }}>
                  LiDAR Status
                </h3>
              </div>
              
              <div style={{ display: 'flex', flexDirection: 'column', gap: '14px' }}>
                <div style={{ 
                  display: 'flex', 
                  justifyContent: 'space-between', 
                  alignItems: 'center',
                  padding: '10px',
                  backgroundColor: 'rgba(0, 0, 0, 0.2)',
                  borderRadius: '8px'
                }}>
                  <span style={{ fontSize: '13px', color: colors.textDim, fontWeight: '500' }}>Total Scans</span>
                  <span style={{
                    fontSize: '18px',
                    fontWeight: '800',
                    color: colors.accent
                  }}>
                    {scanCount}
                  </span>
                </div>
                
                <div style={{ 
                  display: 'flex', 
                  justifyContent: 'space-between', 
                  alignItems: 'center',
                  padding: '10px',
                  backgroundColor: 'rgba(0, 0, 0, 0.2)',
                  borderRadius: '8px'
                }}>
                  <span style={{ fontSize: '13px', color: colors.textDim, fontWeight: '500' }}>Last Scan ID</span>
                  <span style={{
                    fontSize: '13px',
                    fontWeight: '700',
                    color: lastScanId ? colors.info : colors.textDim,
                    fontFamily: 'monospace'
                  }}>
                    {lastScanId || 'N/A'}
                  </span>
                </div>
                
                <div style={{ 
                  display: 'flex', 
                  justifyContent: 'space-between', 
                  alignItems: 'center',
                  padding: '10px',
                  backgroundColor: 'rgba(0, 0, 0, 0.2)',
                  borderRadius: '8px'
                }}>
                  <span style={{ fontSize: '13px', color: colors.textDim, fontWeight: '500' }}>Depth Data</span>
                  <span style={{
                    fontSize: '13px',
                    fontWeight: '700',
                    color: depthDataAvailable ? colors.accent : colors.textDim
                  }}>
                    {depthDataAvailable ? 'Available' : 'N/A'}
                  </span>
                </div>
              </div>
            </div>

            {/* Activity Log */}
            <div className="glass" style={{
              borderRadius: '16px',
              padding: '20px',
              flex: 1,
              display: 'flex',
              flexDirection: 'column',
              minHeight: '320px',
              border: `1px solid ${colors.borderDim}`
            }}>
              <div style={{
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'space-between',
                marginBottom: '18px'
              }}>
                <div style={{ display: 'flex', alignItems: 'center', gap: '10px' }}>
                  <ActivityIcon />
                  <h3 style={{ 
                    fontSize: '14px', 
                    fontWeight: '700', 
                    margin: 0, 
                    letterSpacing: '0.5px',
                    textTransform: 'uppercase'
                  }}>
                    Activity Log
                  </h3>
                </div>
                
                <button
                  onClick={clearLog}
                  className="smooth-transition"
                  style={{
                    backgroundColor: 'transparent',
                    border: `1px solid ${colors.borderDim}`,
                    color: colors.textDim,
                    borderRadius: '8px',
                    padding: '6px 12px',
                    cursor: 'pointer',
                    display: 'flex',
                    alignItems: 'center',
                    gap: '6px',
                    fontSize: '11px',
                    fontWeight: '600'
                  }}
                  onMouseEnter={(e) => {
                    e.target.style.borderColor = colors.accent;
                    e.target.style.color = colors.accent;
                    e.target.style.backgroundColor = 'rgba(0, 255, 136, 0.1)';
                  }}
                  onMouseLeave={(e) => {
                    e.target.style.borderColor = colors.borderDim;
                    e.target.style.color = colors.textDim;
                    e.target.style.backgroundColor = 'transparent';
                  }}
                >
                  <Trash2Icon />
                  Clear
                </button>
              </div>

              <div
                ref={logRef}
                className="scrollbar"
                style={{
                  flex: 1,
                  overflowY: 'auto',
                  display: 'flex',
                  flexDirection: 'column',
                  gap: '10px',
                  minHeight: 0
                }}
              >
                {actions.length === 0 ? (
                  <div style={{
                    textAlign: 'center',
                    padding: '40px 20px',
                    color: colors.textDim
                  }}>
                    <p style={{ fontSize: '13px', marginBottom: '8px' }}>
                      {isConnected ? 'Waiting for activity...' : 'Connect to backend to see activity'}
                    </p>
                    <p style={{ fontSize: '11px', opacity: 0.6 }}>
                      Robot commands will appear here
                    </p>
                  </div>
                ) : (
                  actions.map((action, idx) => (
                    <div
                      key={idx}
                      className="slide-in smooth-transition"
                      style={{
                        background: `linear-gradient(90deg, ${action.color}15 0%, transparent 100%)`,
                        border: `1px solid ${action.color}30`,
                        borderLeft: `4px solid ${action.color}`,
                        borderRadius: '10px',
                        padding: '12px 14px'
                      }}
                    >
                      <div style={{
                        fontSize: '13px',
                        marginBottom: '6px',
                        fontWeight: '600',
                        color: action.color
                      }}>
                        {action.text}
                      </div>
                      <div style={{
                        fontSize: '11px',
                        color: colors.textDim,
                        fontFamily: 'monospace',
                        fontWeight: '500'
                      }}>
                        {action.time}
                      </div>
                    </div>
                  ))
                )}
              </div>
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.render(<KnightMobile />, document.getElementById('root'));
  </script>
</body>
</html>
